# π’½Linux μ„λ²„κ°„μ νμΌ μ „μ†΅

μ΄ λ ν¬μ§€ν† λ¦¬λ” κ°λ° μ„λ²„μ™€ μ΄μ μ„λ²„ κ°„μ νμΌ μ „μ†΅ λ°©λ²•μ— λ€ν•΄ λ‹¤λ£Ήλ‹λ‹¤.

## μ‚¬μ© κΈ°μ 
![Spring](https://img.shields.io/badge/Spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white)
![Jenkins](https://img.shields.io/badge/jenkins-%232C5263.svg?style=for-the-badge&logo=jenkins&logoColor=white)
![Linux](https://img.shields.io/badge/linux-%23FCC624.svg?style=for-the-badge&logo=linux&logoColor=black)



## λ©μ°¨
1. [Linux μ„λ²„ νμΌ κ³µμ  λ°©λ²•](#linux-μ„λ²„-νμΌ-κ³µμ -λ°©λ²•)
2. [ν”„λ΅μ νΈ μ›ν¬ν”λ΅: κ°λ° μ„λ²„μ™€ μ΄μ μ„λ²„ κ°„ JAR νμΌ μλ™ μ „μ†΅ λ° μ—…λ°μ΄νΈ](#ν”„λ΅μ νΈ-μ›ν¬ν”λ΅-κ°λ°-μ„λ²„μ™€-μ΄μ-μ„λ²„-κ°„-jar-νμΌ-μλ™-μ „μ†΅-λ°-μ—…λ°μ΄νΈ)
    - [μ‹μ¤ν… κ°μ”](#1-μ‹μ¤ν…-κ°μ”)
    - [νμΌ κ°μ§€ λ° μ „μ†΅ μ¤ν¬λ¦½νΈ](#2-νμΌ-κ°μ§€-λ°-μ „μ†΅-μ¤ν¬λ¦½νΈ)
        1. [send.sh μ¤ν¬λ¦½νΈ](#1-sendsh-μ¤ν¬λ¦½νΈ)
        2. [change.sh μ¤ν¬λ¦½νΈ](#2-changesh-μ¤ν¬λ¦½νΈ)
        3. [autorunning.sh μ¤ν¬λ¦½νΈ](#3-autorunningsh-μ¤ν¬λ¦½νΈ)
3. [κ²°λ΅ ](#3-κ²°λ΅ )

---

## Linux μ„λ²„ νμΌ κ³µμ  λ°©λ²•

### 1λ‹¨κ³„: SSH μ„¤μ •

μ„λ²„ κ°„ μ•μ „ν• νμΌ μ „μ†΅μ„ μ„ν•΄ λ¨Όμ € λ΅μ»¬ μ„λ²„μ™€ μ›κ²© μ„λ²„ κ°„μ SSH μ ‘μ†μ„ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤.

1. **λ΅μ»¬ μ„λ²„μ—μ„ SSH ν‚¤ μƒμ„±**:
   ```bash
   ssh-keygen -t rsa -b 4096
   ```
2. **μƒμ„±ν• SSH ν‚¤λ¥Ό μ›κ²© μ„λ²„μ— λ³µμ‚¬**:
   ```bash
   ssh-copy-id [μ‚¬μ©μλ…]@[μ›κ²©_IP]
   ```
   μ΄ λ…λ Ήμ–΄λ” κ³µκ° ν‚¤λ¥Ό μ›κ²© μ„λ²„λ΅ λ³µμ‚¬ν•μ—¬ μ•”νΈ μ—†μ΄ SSH μ ‘μ†μ„ κ°€λ¥ν•κ² λ§λ“­λ‹λ‹¤.

3. **μ›κ²© μ„λ²„λ΅ SSH μ ‘μ† ν™•μΈ**:
   ```bash
   ssh [μ‚¬μ©μλ…]@[μ›κ²©_IP]
   ```
   λΉ„λ°€λ²νΈ μ…λ ¥ μ—†μ΄ μ›κ²© μ„λ²„μ— μ ‘μ†ν•  μ μμΌλ©΄ μ„±κ³µμ…λ‹λ‹¤.

4. **SSH ν‚¤κ°€ μ λ€λ΅ μ¶”κ°€λμ—λ”μ§€ ν™•μΈ**:
   ```bash
   cat ~/.ssh/authorized_keys
   ```
   κ³µκ° ν‚¤κ°€ μ΄ νμΌμ— λ‚μ™€ μμ–΄μ•Ό ν•©λ‹λ‹¤.

### 2λ‹¨κ³„: `scp` λ…λ Ήμ–΄λ΅ νμΌ μ „μ†΅

SSH μ„¤μ •μ΄ μ™„λ£λλ©΄, `scp` (secure copy) λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄ μ„λ²„ κ°„ νμΌμ„ μ „μ†΅ν•  μ μμµλ‹λ‹¤.

#### λ‹¨μΌ νμΌμ„ μ›κ²© μ„λ²„λ΅ μ „μ†΅ν•κΈ°

- λ΅μ»¬ μ„λ²„μ—μ„ μ›κ²© μ„λ²„λ΅ νμΌμ„ μ „μ†΅ν•λ ¤λ©΄ μ•„λ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤:
   ```bash
   scp [νμΌλ…] [μ‚¬μ©μλ…]@[μ›κ²©_IP]:[μ €μ¥_κ²½λ΅]
   ```
   - `[νμΌλ…]`: μ „μ†΅ν•  νμΌμ μ΄λ¦„
   - `[μ‚¬μ©μλ…]`: μ›κ²© μ„λ²„μ μ‚¬μ©μλ…
   - `[μ›κ²©_IP]`: μ›κ²© μ„λ²„μ IP μ£Όμ†
   - `[μ €μ¥_κ²½λ΅]`: νμΌμ„ μ €μ¥ν•  μ›κ²© μ„λ²„μ κ²½λ΅

---

## ν”„λ΅μ νΈ μ›ν¬ν”λ΅: κ°λ° μ„λ²„μ™€ μ΄μ μ„λ²„ κ°„ JAR νμΌ μλ™ μ „μ†΅ λ° μ—…λ°μ΄νΈ

μ΄ ν”„λ΅μ νΈλ” GitHub λ¦¬ν¬μ§€ν† λ¦¬μ—μ„ λ°μƒν• λ³€λ™ μ‚¬ν•­μ„ κ°μ§€ν•μ—¬ κ°λ° μ„λ²„μ™€ μ΄μ μ„λ²„ κ°„μ— JAR νμΌμ„ μλ™μΌλ΅ μ „μ†΅ λ° μ—…λ°μ΄νΈν•λ” μ‹μ¤ν…μ„ κµ¬μ¶•ν•©λ‹λ‹¤.

### 1. μ‹μ¤ν… κ°μ”

1. **κ°λ° μ„λ²„**μ™€ **μ΄μ μ„λ²„**κ°€ μ΅΄μ¬ν•©λ‹λ‹¤.
2. GitHubμ— λ³€κ²½ μ‚¬ν•­μ΄ λ°μƒν•λ©΄ **Jenkins νμ΄ν”„λΌμΈ**μ΄ μλ™μΌλ΅ κ°λ° μ„λ²„μ `SpringApp-0.0.1-SNAPSHOT.jar` νμΌμ„ μ—…λ°μ΄νΈν•©λ‹λ‹¤.
3. **κ°λ° μ„λ²„**μ—μ„ JAR νμΌμ λ³€λ™ μ‚¬ν•­μ„ κ°μ§€ν•λ” **μ‰ μ¤ν¬λ¦½νΈ**κ°€ μ‹¤ν–‰λ©λ‹λ‹¤.
4. μ¤ν¬λ¦½νΈλ” μμ •λ JAR νμΌμ„ **μ΄μ μ„λ²„**λ΅ μ „μ†΅ν•©λ‹λ‹¤.
5. **μ΄μ μ„λ²„**λ” κΈ°μ΅΄μ— μ‹¤ν–‰ μ¤‘μ΄λ `SpringApp-0.0.1` νμΌμ„ μƒλ΅μ΄ νμΌλ΅ λ®μ–΄μ“°κ³ , μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ¬μ‹¤ν–‰ν•©λ‹λ‹¤.

---

### 2. νμΌ κ°μ§€ λ° μ „μ†΅ μ¤ν¬λ¦½νΈ

[κ°λ° μ„λ²„] JAR νμΌμ΄ μμ •λμ—μ„ λ• μ΄λ¥Ό κ°μ§€ν•κ³  μ΄μ μ„λ²„λ΅ μ „μ†΅ν•λ” μ¤ν¬λ¦½νΈμ…λ‹λ‹¤.

#### 1. `send.sh` μ¤ν¬λ¦½νΈ

```bash
#!/bin/bash

JAR_FILE="./SpringApp-0.0.1-SNAPSHOT.jar"
FILENAME=$(basename "$JAR_FILE")

# μ›κ²© μ„λ²„ μ •λ³΄
REMOTE_USER=""
REMOTE_SERVER=""
REMOTE_PATH="/home/username/updateJAR"

# λ³€κ²½ μ‚¬ν•­ κ°μ§€ λ° νμΌ μ „μ†΅
inotifywait -m -e close_write "$JAR_FILE" |
while read -r directory events; do
    CURRENT_TIME=$(date +%s)

    if (( CURRENT_TIME - LAST_RUN > COOLDOWN )); then
        echo "$(date): $FILENAME νμΌμ΄ μμ •λμ—μµλ‹λ‹¤."

        # μμ •λ JAR νμΌμ„ μ›κ²© μ„λ²„λ΅ μ „μ†΅
        echo "$(date): $FILENAME νμΌμ„ μ›κ²© μ„λ²„λ΅ μ „μ†΅ μ¤‘..."
        scp "$JAR_FILE" "$REMOTE_USER@$REMOTE_SERVER:$REMOTE_PATH/$FILENAME"

        LAST_RUN=$CURRENT_TIME
    else
        echo "$(date): μΏ¨λ‹¤μ΄ μ¤‘μ…λ‹λ‹¤."
    fi
done
```

μ΄ μ¤ν¬λ¦½νΈλ” `inotifywait`λ¥Ό μ‚¬μ©ν•μ—¬ `SpringApp-0.0.1-SNAPSHOT.jar` νμΌμ λ³€κ²½ μ‚¬ν•­μ„ κ°μ§€ν•©λ‹λ‹¤. νμΌμ΄ μμ •λλ©΄ μ΄λ¥Ό μ›κ²© μ„λ²„λ΅ μ „μ†΅ν•κ³ , μΏ¨λ‹¤μ΄ μ‹κ°„(10μ΄)μ΄ μ„¤μ •λμ–΄ λ°λ³µ μ‹¤ν–‰μ„ λ°©μ§€ν•©λ‹λ‹¤.

#### 2. `change.sh` μ¤ν¬λ¦½νΈ

[μ΄μ μ„λ²„] μ΄ μ¤ν¬λ¦½νΈλ” νμΌ λ³€κ²½μ„ κ°μ§€ν• ν›„, λ³„λ„μ μ¤ν¬λ¦½νΈ(`autorunning.sh`)λ¥Ό νΈμ¶ν•μ—¬ νμΌμ„ μ΄μ μ„λ²„λ΅ μ „μ†΅ν•κ³  μ‹¤ν–‰ν•©λ‹λ‹¤.

```bash
#!/bin/bash

JAR_FILE="./SpringApp-0.0.1-SNAPSHOT.jar"
SH_FILE="./autorunning.sh"
COOLDOWN=10
LAST_RUN=0

inotifywait -m -e close_write "$JAR_FILE" |
while read -r directory events filename; do
    CURRENT_TIME=$(date +%s)
    if (( CURRENT_TIME - LAST_RUN > COOLDOWN )); then
        echo "$(date): $filename νμΌμ΄ κ°μ§€λμ—μµλ‹λ‹¤."
        bash "$SH_FILE"
        LAST_RUN=$CURRENT_TIME
    else
        echo "$(date): μΏ¨λ‹¤μ΄ μ¤‘μ…λ‹λ‹¤."
    fi
done
```
#### 2. `autorunning.sh` μ¤ν¬λ¦½νΈ
```bash
#!/bin/bash

if  lsof -i :8999 > /dev/null; then
  kill -9 $(lsof -t -i:8999)
  echo 'μ •μƒμ μΌλ΅ μΆ…λ£λμ—μµλ‹λ‹¤.'
fi

nohup java -jar SpringApp-0.0.1-SNAPSHOT.jar > app.log 2>&1 &
echo "λ°°ν¬μ™„λ£ λ° μ¬ μ‹¤ν–‰λ©λ‹λ‹¤."
```
---

### 3. κ²°λ΅ 

μ΄ μ›ν¬ν”λ΅λ” GitHubμ—μ„ λ°μƒν• λ³€κ²½ μ‚¬ν•­μ„ κ°μ§€ν•μ—¬ κ°λ° μ„λ²„μ™€ μ΄μ μ„λ²„ κ°„μ νμΌ λ™κΈ°ν™”λ¥Ό μλ™ν™”ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ JAR νμΌ μ „μ†΅ λ° μ• ν”λ¦¬μΌ€μ΄μ… μ—…λ°μ΄νΈλ¥Ό μλ™μΌλ΅ μ²λ¦¬ν•  ν•„μ”κ°€ μ—†μ–΄μ§€λ©°, μ΄μ ν™κ²½μ—μ„ μµμ‹  μ½”λ“λ¥Ό ν•­μƒ μ μ§€ν•  μ μμµλ‹λ‹¤.
